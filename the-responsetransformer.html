<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Apai-io : Amazon Product Adverstising Library based on PHP REST and SOAP using the Product Advertising API." />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="screen" href="styles/sunburst.css">

    <script type="text/javascript" src="javascripts/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <title>Apai-IO</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Exeu/apai-io">View on GitHub</a>

          <h1 id="project_title">Apai-IO</h1>
          <h2 id="project_tagline">Amazon-Product-Adverstising-API library based on PHP using REST and SOAP.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/Exeu/apai-io/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/Exeu/apai-io/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>The ResponseTransformer</h1>
        <p>
        The Responsetransformer is a nice way to manipulate the response which comes from the amazon api.
        </p>
        <p>For example if you making a REST call, you will get back a xml response which contains all items of the specified responsegroup.</p>
        <p>So what to do if you want to change this response? The answer is: The ResponseTransfomer!</p>

            <ul>
                <li><a href="#under">ResponseTransfomer under the hood (interface)</a></li>
                <li>
                    <a href="#builtin">Built in Responsetransformer</a>
                    <ul>
                        <li><a href="#ObjectToArray">ObjectToArray</a></li>
                        <li><a href="#XmlToDomDocument">XmlToDomDocument</a></li>
                        <li><a href="#Xslt">Xslt</a></li>
                    </ul>
                </li>
                <li><a href="#own">Creating your own ResponseTransformer</a></li>
            </ul>


        <a name="under"></a>
        <h2>ResponseTransfomer under the hood (interface)</h2>
<pre><code class="php">namespace ApaiIO\ResponseTransformer;

interface ResponseTransformerInterface
{
    /**
     * Transforms the response of the request
     *
     * @param mixed $response
     */
    public function transform($response);
}</code></pre>

        <p>Every ResponseTransformer implements this simple interface. The function transform takes care about transforming the response which comes from amazon.</p>
        <p>Nothing else to do! You have the choice: You can build your own ResponseTransformer or you can use one of the built in.</p>

        <a name="builtin"></a>
        <h2>Built in Responsetransformer</h2>
        <p>apai-io comes with some build in ResponseTransfomer classes.</p>

        <a name="ObjectToArray"></a>
        <h3>ObjectToArray</h3>
        <p>The ObjectToArray ResponseTransformer transforms Objects (stdClass) to an array. Its basicly used when you decided to make SOAP requests.</p>

        <p>You can pass the fully quallified class name to the configuration object which you use:</p>
<pre><code class="php">use ApaiIO\Configuration\GenericConfiguration;
use ApaiIO\ApaiIO;

$conf = new GenericConfiguration();
$conf
    ->setCountry('com')
    ->setAccessKey(AWS_API_KEY)
    ->setSecretKey(AWS_API_SECRET_KEY)
    ->setAssociateTag(AWS_ASSOCIATE_TAG)
    ->setRequest('\ApaiIO\Request\Soap\Request')
    ->setResponseTransformer('\ApaiIO\ResponseTransformer\ObjectToArray');

$apaiIo = new ApaiIO($conf);

// ... Preparing your operation

$response = $apaiIo->runOperation($operation);
</code></pre>

        <p>If you run this code the <code>$response</code> will be an array containing the whole response from the amazon api.</p>
        <p>You now can access the key you want or iterate over it.</p>
        <p>Note: This will only work if you are going to make SOAP Requests.</p>

        <a name="XmlToDomDocument"></a>
        <h3>XmlToDomDocument</h3>
        <p>By default apai-io uses REST request to query the amazon database.</p>
        <p>All REST requests having a XML-String as response</p>
        <p>The XmlToDomDocument transformer transforms the XML-Response to an instance of <a href="http://de2.php.net/manual/en/class.domdocument.php" target="_blank">\DOMDocument</a>.</p>

<pre><code class="php">use ApaiIO\Configuration\GenericConfiguration;
use ApaiIO\ApaiIO;

$conf = new GenericConfiguration();
$conf
    ->setCountry('com')
    ->setAccessKey(AWS_API_KEY)
    ->setSecretKey(AWS_API_SECRET_KEY)
    ->setAssociateTag(AWS_ASSOCIATE_TAG)
    ->setResponseTransformer('\ApaiIO\ResponseTransformer\XmlToDomDocument');

$apaiIo = new ApaiIO($conf);

// ... Preparing your operation

$response = $apaiIo->runOperation($operation);
</code></pre>

        <a name="Xslt"></a>
        <h3>Xslt</h3>
        <p>If you want to transform a XML to a for example usage ready HTML you can use the XSLT Transformer.</p>
        <p>What XSLT is, you can see here: <a href="http://en.wikipedia.org/wiki/XSLT">Wikipedia :)</a></p>

<pre><code class="php">use ApaiIO\Configuration\GenericConfiguration;
use ApaiIO\ApaiIO;
use ApaiIO\ResponseTransformer\Xslt;

$xsltResponseTransformer = new Xslt($xstlTemplate); // $xstlTemplate -> String

$conf = new GenericConfiguration();
$conf
    ->setCountry('com')
    ->setAccessKey(AWS_API_KEY)
    ->setSecretKey(AWS_API_SECRET_KEY)
    ->setAssociateTag(AWS_ASSOCIATE_TAG)
    ->setResponseTransformer($xsltResponseTransformer);

$apaiIo = new ApaiIO($conf);

// ... Preparing your operation

$response = $apaiIo->runOperation($operation);
</code></pre>

        <a name="own"></a>
        <h2>Creating your own ResponseTransformer</h2>
        <p>If you need your own ResponseTransformer you can simply achieve this by implementing the ResponseTransformerInterface and passing the instance of your class or its name to the configuration object.</p>
        <p>Let's build our own Transformer which returns all Item Elements via XPath.</p>

<pre><code class="php">namespace Acme\Demo;

use ApaiIO\ResponseTransformer\ResponseTransformerInterface;

class ItemSearchXmlToItems implements ResponseTransformerInterface
{
    public function transform($response)
    {
        $xml =  simplexml_load_string($response);
        $xml->registerXPathNamespace("amazon", "http://webservices.amazon.com/AWSECommerceService/2011-08-01");

        $elements = $xml->xpath('//amazon:ItemSearchResponse/amazon:Items/amazon:Item');

        return $elements;
    }
}</code></pre>

        <p>Now you have build the class you can use it out of the box:</p>

<pre><code class="php">use ApaiIO\Configuration\GenericConfiguration;
use ApaiIO\ApaiIO;
use Acme\Demo\ItemSearchXmlToItems;

$itemSearchXmlToItems = new ItemSearchXmlToItems();

$conf = new GenericConfiguration();
$conf
    ->setCountry('com')
    ->setAccessKey(AWS_API_KEY)
    ->setSecretKey(AWS_API_SECRET_KEY)
    ->setAssociateTag(AWS_ASSOCIATE_TAG)
    ->setResponseTransformer($itemSearchXmlToItems);

$apaiIo = new ApaiIO($conf);

// ... Preparing your operation

$response = $apaiIo->runOperation($operation);
</code></pre>

        <p>If you dont want to instanciate the object you can pass the fully quallified class name:</p>

<pre><code class="php">$conf->setResponseTransformer('\Acme\Demo\ItemSearchXmlToItems');

$apaiIo = new ApaiIO($conf);

// ... Preparing your operation

$response = $apaiIo->runOperation($operation);
</code></pre>
      </section>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Apai-io maintained by <a href="https://github.com/Exeu">Exeu</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-41769129-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
